2025 09 1511 05
Tags: #mongodb
###### Links: 
1) 
# Заметка
С помощью проекций мы можем указать MongoDB, какие именно поля выбранных документов нам нужны. Например, при выборке пользователей нам нужны только их имя и email. Сделать это можно с помощью аргумента `FindOptions` метода `find`:
```ts
db.users.find({}, { "name": 1, "email": 1});
```
В объекте мы указываем поля, которые нам нужны, а все остальные не будут возвращены. Исключением будет только поле `_id`, оно не будет возвращено только если явно это указать:
```ts
// вернёт все поля документов, кроме _id и password
db.users.find({}, { "_id": 0, "password": 0 });
```
Как и для фильтра, можно включить и исключить конкретные поля поддокументов:
```ts
db.books.find({}, { "editions.year": 1 });
db.books.find({}, { "editions.publisher": 0 });
```
Для проекций примитивных значений и поддокументов нет дополнительных операторов, поскольку в них мы просто выбираем, какую часть документа нужно отобразить. Но в случае с массивами часто нужна только часть данных. Например, иногда нужно получить только элементы массива, которые подходят под условие, или выбрать только часть значений из массива. С этим нам помогут операторы `$`, `$elemMatch`и `$slice`:

- `$` — возвращает первый элемент, который подходит под условие в фильтре.
- `$elemMatch` похож на одноимённый оператор для фильтра, но влияет только на вывод данных, никак не фильтруя выборку.
- `$slice` позволяет вывести только часть массива, почти так же, как и знакомый вам метод `Array.slice` в JavaScript.
```ts
db.books.find(
  { "editions.year": { "$gte": 2018 } },
  // в массив попадёт только первый элемент, подходящий под условие в фильтре
  { "editions.$": 1 }
);

db.books.find({}, {
    // аналогично примеру выше, в массив попадёт первый элемент, подходящий под условие
  $elemMatch: { "editions.year": { "$gte": 2018 } }
});

db.books.find({}, {
    // вернёт первые три элемента массива
  "editions": { "$slice": 3 }
});

db.books.find({}, {
    // вернёт последние три элемента массива
  "editions": { "$slice": -3 }
});

db.books.find({}, {
    // вернёт три элемента массива, начиная со второго
  "editions": { "$slice": [1, 3] }
});
```
