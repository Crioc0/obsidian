2025 09 1610 34
Tags: #mongodb
###### Links: 
1) 
# Заметка

Индексы — мощный инструмент для оптимизации поиска по базе данных, но и он имеет свою цену. При работе с данными часто приходится идти на компромисс, например, между памятью или скоростью работы. Также стоит учитывать доступность БД и создавать индексы только тогда, когда это действительно необходимо.

**Память**

Каждый новый индекс занимает дополнительную память — как оперативную, так и на жёстком диске. А с ростом коллекции размер индекса тоже будет расти. Именно поэтому не стоит создавать индекс сразу по всем полям документа — его размер может быть сравним с размером коллекции. Следует строить индексы только для полей, по которым можно идентифицировать документ, поэтому MongoDB автоматически создаёт индекс для `_id`.

**Скорость**

Индексы увеличивают скорость поиска данных в коллекции, но при этом уменьшают скорость добавления новых. При вставке MongoDB должна добавить новый документ в индексы коллекции. Чем больше индексов и чем они сложнее, тем дольше будет происходить вставка. Поэтому для коллекций, где вставки происходят часто, индекс может только ухудшить производительность.

**Доступность**

Обычно индексы создают не при проектировании базы данных, а уже в процессе эксплуатации приложения, но при этом коллекция становится менее доступна из-за блокировки на чтение и запись. Поэтому для создания индекса нужно правильно подобрать время, чтобы не затронуть пользователей.

**Необходимость**

Если приложение уже работает и вы хотите ускорить его, вы можете проанализировать частые запросы, их производительность, а также поведение пользователей. Затем по этим данным можно определить, где необходимо создать индекс. Но просто создать индексы недостаточно, нужно постоянно анализировать их использование: добавлять новые, когда необходимо, и удалять старые, когда они стали неэффективны.

Для анализа использования индексов удобно применять MongoDB Compass. Во вкладке Indexes можно создать индекс, а во вкладке Explain Plan — выполнять запросы. Compass наглядно покажет, какие этапы были выполнены для запроса.