2025 09 1109 18
Tags: #nodejs #express 
###### Links: 
1) [[Мидлвар парсер данных body-parser]]
# Заметка
Мидлвары - функции промежуточной обработки. Они обрабатывают запросы, при необходимости меняют данные или вовсе не пускают запросы дальше. В мидлвары удобно выносить типовые и повторяющееся задачи
## Создание мидлвара
```ts
// Проверим, существует ли пользователь:
const doesUserExist = (req: Request, res: Response, next: NextFunction) => {
  if (!users[req.params.id]) {
    res.send(`Такого пользователя не существует`);
    return;
  }

  next(); // вызываем next
};

const sendUser = req: Request, res: Response, next: NextFunction) => {
  res.send(users[req.params.id]);
};
```
Если пользователь найден, то вызывается функция, переданная третим аргументом
```ts
router.get('/users/:id', doesUserExist);
router.get('/users/:id', sendUser);
```
Фреймворк Express написан так, что если для одного запроса есть несколько обработчиков, он будет считать функцией `next` следующий обработчик этого же запроса.

Колбэк мидлвара принято всегда называть `next`. Старайтесь не отходить от этого правила, чтобы ваш код был понятен другим разработчикам.
## Подключение мидлвара
Для использования мидлвара мы будем пользоваться методом `use`, но с одним параметром — самим мидлваром:
```ts
app.use(middleware);
```