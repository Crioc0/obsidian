2025 09 2316 12
Tags: #безопасность 
###### Links: 
1) 
# Заметка
Основная защита от XSS — правильно написанный код веб-приложения: с ограниченным вводом и экранированием символов. Но бывает всякое, и злоумышленник всё равно может найти способ внедрить скрипт в браузер пользователя. На этот случай есть вторая линия защиты — инструкция Content Security Policy.
Эта инструкция позволяет ограничить источники, откуда сайт может загружать скрипты, изображения, файлы стилей и медиафайлы.

Есть два варианта установить инструкцию:
1) 1. В метатеге. Можно добавить в раздел `head` тег `meta` и описать ограничения там:
```ts
<meta http-equiv="Content-Security-Policy" content="ИНСТРУКЦИИ">
```
2) 2. В HTTP-заголовке:
```ts
Content-Security-Policy: /* ИНСТРУКЦИИ */
```
## Как оформить инструкцию?

Есть 5 видов инструкций:

- `default-src` — обязательная инструкция, задаёт источник всех видов ресурсов по умолчанию;
- `script-src` — источник скриптов;
- `img-src` — изображения;
- `media-src` — аудио- и видео-файлы;
- `style-src` — файлы стилей.
После имени инструкции указывают сами источники через пробел. Чтобы указать домен сайта как источник, устанавливают ключевое слово `'self'`.
```ts
"script-src 'self' *.site.com"; // скрипты можно загружать с самого сайта, либо с поддоменов site.com, например, с https://example.site.com
```
В конце каждой инструкции должна стоять точка с запятой:
```ts
Content-Security-Policy: default-src 'self'; img-src *; media-src media1.com media2.com; script-src userscripts.example.com
```
## Контроль версии браузера
Более новые браузеры обычно лучше защищены. Поэтому во имя безопасности можно запретить вход на сайт пользователям со старых браузеров.

Браузер отправляет свою версию в любом запросе внутри заголовка User-Agent. Этот заголовок имеет формат:
```ts
User-Agent: <product> / <product-version> <comment>
```
Не пускать пользователя со старого браузера хорошо для безопасности. Но для пользователя это неудобно. Это противоречие породило два подхода:

- поддерживать максимально возможное число браузеров, вплоть до старых версий Internet Explorer;
- не пускать пользователей старых браузеров.