2025 09 1511 00
Tags: #MongoDB 
###### Links: 
1) [[Проекции MongoDB]]
2) [[Работа с курсором]]
# Заметка
MongoDB — документная СУБД, поэтому данные можно хранить в массивах или объектах внутри документа.
Для запросов к поддокументам достаточно повторить структуру в фильтре запроса:
```ts
db.books.find({
  firstEdition: {
    year: 2018,
        reprint: true        
  }
});
```
Если же фильтр нужен только по одному из полей, можно обратиться к нему через точку:
```ts
db.books.find({
  "firstEdition.reprint": false
});

// вложенность не ограничена
db.books.find({
 "firstEdition.publisher.country": "United Kingdom"
});
```
Чтобы найти документ, который содержит массив с конкретными элементами в определённом порядке, можно просто передать ожидаемое значение массива:
```ts
db.books.find({
  "subjects": [ "British", "Classic Literature" ]
});
```
Если нужно выбрать документы, которые содержат массив со значениями (вне зависимости от порядка), можно воспользоваться оператором `$all`:
```ts
db.books.find({
    // вернёт все документы, в которых в массиве languages есть значение "British" или "Classic Literature" 
  "languages": { "$all": ["British", "Classic Literature"] }
});
```
Если значение только одно, можно использовать упрощённую запись:
```ts
db.books.find({
  "languages": "British"
});
```
Помимо прямого сравнения оператором `$all`, можно использовать над элементами массива любые другие операторы:
```ts
db.books.find({
 // можем фильтровать и по полям документов в массиве
 "editions.year": { "$gte": 2010 }
});
```
Но в этом примере в выборку попадут все документы, в которых хотя бы один элемент в массиве удовлетворяет условию. Если нужно, чтобы все элементы массива подходили под условие фильтра, необходимо воспользоваться оператором `$elemMatch`:
```ts
db.books.find({
 "editions.year": { "$elemMatch": { "$gte": 2010 } }
});
```
И ещё один приём для работы с массивами — обращение к конкретному элементу. Это удобно, если вы храните данные как кортеж. Допустим, размеры книги хранятся в сантиметрах в виде массива `[width, height]`:
```ts
db.books.find({
    // выбираем все книги, у которых ширина меньше или равно 40 см
  "size.1": { "$lte": 40 }
});
```