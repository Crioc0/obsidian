2025 09 1610 07
Tags: #mongodb
###### Links: 
1) 
# Заметка
Многоключевой индекс — особый вид индекса, который применяется для массивов. Индекс строится по полю, в котором содержится массив. А ключ в таком индексе — элемент массива. Ключ указывает на несколько документов, а каждый документ может быть доступен по нескольким ключам.
Чтобы создать многоключевой индекс, дополнительно ничего указывать не нужно, MongoDB сделает это автоматически, если поле является массивом
```ts
db.posts.createIndex({ "tags": 1 });
```
Также multikey индекс будет создан, если он строится по полям объектов в массиве:
```ts
{
    "comments": [
        {
            "text": "Comment",
            "author": {
            "name": "johndoe"
            }
        }
    ]
}

db.posts.createIndex({ "comments.author.name": 1 });
```
При использовании многоключевых индексов стоит помнить об ограничениях:

1. В составном индексе можно иметь только один multikey индекс.
2. При запросах на точное совпадение массива (`db.posts.find({tags: ["js", "ts"]})`) multikey индекс не будет использован.
3. MongoDB не будет использовать multikey индекс при использовании оператора `$expr` в фильтре.
Подробнее об этом [в документации](https://mongodb.prakticum-team.ru/docs/manual/core/index-multikey/#limitations).