2025 09 1713 54
Tags: #MongoDB #mongoose 
###### Links: 
1) 
# Заметка
Одна из особенностей нереляционных баз данных- отсутствие схемы. Схема - набор требований к данным.

Схема накладывает ограничения на данные, которые записаны в базу. Современные NoSQL базы позволяют использовать схемы выборочно.

В MOngoDB нет поддержки схем по умолчанию, но их можно добавить через Mongoose.  Это нужно для того, чтобы проверить, соответствует ли документ схеме, прежде чем записывать его в БД.

## Создание схемы
Для созданиея используется `new mongoose.Schema`
```ts
// models/user.ts
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  name: { // у пользователя есть имя — опишем требования к имени в схеме:
    type: String, // имя — это строка
    required: true, // имя — обязательное поле
    minlength: 2, 
    maxlength: 30, 
  },
  gender: {
    type: String, // гендер — это строка
    enum: ['м', 'ж', 'другой']
  },
  about: String,
});
```
Для нестандартной валидации можно писать свои способы проверки данных с помощью свойства validate. Это объект, свойствами которого являются
- validator - функция валидации, возвращающее булевое значение
- message - сообщние об ошибке, срабатывает, если функция валидации возвращает false
## Свойства-объекта
Если свойство документа должно быть объектом, придётся воспользоваться методом `Schema` дважды:

- первый вызов нужен для создания схемы объекта: в нём мы описываем, какую структуру должно иметь свойство;
- второй — для передачи описанной схемы в свойство, которое должно иметь эту структуру:
```ts
// models/user.ts

import mongoose from "mongoose";

// создадим схему документа «Домашнее животное»
const petSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
    minlength: 2,
    maxlength: 30,
  },
  age: Number
});
// Когда схема готова, передадим её в свойство, которое должно соответствовать описанному шаблону:
const userSchema = new mongoose.Schema({
  ...
  pet: petSchema // опишем свойство pet этой схемой
});
```
## Свойства-массивы
Массивы нужны для хранения однотипных данных, поэтому описание схемы массива сводится к описанию шаблона элемента
```ts
// models/user.ts

import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  ...
  hobbies: [{ // описываем схему для одного элемента и заключаем её в квадратные скобки
    type: String,
    minlength: 2,
    maxlength: 30,
  }]
});
```
## Создание модели на основе схемы
Модель - это обертка из методов вокруг схемы. Благодаря ей можно читать, добавлять, удалять и обновлять документы. В Mongoose модель создают методом `mongoose.model`.
```ts
// models/user.ts

import mongoose from "mongoose";
// Опишем схему:
const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
    minlength: 2,
    maxlength: 30,
  },
  about: String,
});

// создаём модель и экспортируем её
export default mongoose.model('user', userSchema);
```
Мы передали методу `mongoose.model` два аргумента: имя модели и схему, которая описывает будущие документы.

Аккуратно — тут можно запутаться. Первый аргумент — имя модели — должен быть существительным в единственном числе. Но Compass отображает его во множественном. Дело в том, что Mongoose автоматически добавляет букву "s" в конце имени коллекции: