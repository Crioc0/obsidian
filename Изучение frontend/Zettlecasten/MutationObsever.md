2025 07 0817 33
Tags: #vue 
###### Links: 
1) [[https://learn.javascript.ru/mutation-observer]]
# Заметка
`MutationObserver` – это встроенный объект, наблюдающий за DOM-элементом и запускающий колбэк в случае изменений.

Сначала нужно создать наблюдатель за изменениями с помощью callback-функции, и прикрепляем его к DOM-узлу
```js
new MutationObserver(callback).observe(node,condig)
```
`config` – это объект с булевыми параметрами «на какие изменения реагировать»:

- `childList` – изменения в непосредственных детях `node`,
- `subtree` – во всех потомках `node`,
- `attributes` – в атрибутах `node`,
- `attributeFilter` – массив имён атрибутов, чтобы наблюдать только за выбранными.
- `characterData` – наблюдать ли за `node.data` (текстовое содержимое),
И ещё пара опций:

- `characterDataOldValue` – если `true`, будет передавать и старое, и новое значение `node.data` в колбэк (см далее), иначе только новое (также требуется опция `characterData`),
- `attributeOldValue` – если `true`, будет передавать и старое, и новое значение атрибута в колбэк (см далее), иначе только новое (также требуется опция `attributes`).
Затем, после изменений выполняется callback, в который изменения передаются первым аргументом как список объектов MutationRecord, а сам наблюдатель идет вторым аргументом.
Объекты [MutationRecord](https://dom.spec.whatwg.org/#mutationrecord) имеют следующие свойства:

- `type` – тип изменения, один из:
    - `"attributes"` изменён атрибут,
    - `"characterData"` изменены данные `elem.data`, это для текстовых узлов
    - `"childList"` добавлены/удалены дочерние элементы,
- `target` – где произошло изменение: элемент для `"attributes"`, текстовый узел для `"characterData"` или элемент для `"childList"`,
- `addedNodes/removedNodes` – добавленные/удалённые узлы,
- `previousSibling/nextSibling` – предыдущий или следующий одноуровневый элемент для добавленных/удалённых элементов,
- `attributeName/attributeNamespace` – имя/пространство имён (для XML) изменённого атрибута,
- `oldValue` – предыдущее значение, только для изменений атрибута или текста, если включена соответствующая опция `attributeOldValue`/`characterDataOldValue`.
## Когда использовать
`MutationObserver` может реагировать на изменения в DOM: атрибуты, добавленные/удалённые элементы, текстовое содержимое.

Мы можем использовать его, чтобы отслеживать изменения, производимые другими частями нашего собственного кода, а также интегрироваться со сторонними библиотеками.

`MutationObserver` может отслеживать любые изменения. Разные опции конфигурации «что наблюдать» предназначены для оптимизации, чтобы не тратить ресурсы на лишние вызовы колбэка.

## [Дополнительные методы](https://learn.javascript.ru/mutation-observer#dopolnitelnye-metody)

Метод, останавливающий наблюдение за узлом:

- `observer.disconnect()` – останавливает наблюдение.

Вместе с ним используют метод:

- `mutationRecords = observer.takeRecords()` – получает список необработанных записей изменений, которые произошли, но колбэк для них ещё не выполнился.

``` `// мы отключаем наблюдатель` observer`.``disconnect``(``)``;`  `// он, возможно, не успел обработать некоторые изменения` `let` mutationRecords `=` observer`.``takeRecords``(``)``;` `// обработать mutationRecords` ```

## [Сборка мусора](https://learn.javascript.ru/mutation-observer#sborka-musora)

Объекты `MutationObserver` используют внутри себя так называемые [«слабые ссылки»](https://ru.wikipedia.org/wiki/%D0%A1%D0%BB%D0%B0%D0%B1%D0%B0%D1%8F_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0) на узлы, за которыми смотрят. Так что если узел удалён из DOM и больше не достижим, то он будет удалён из памяти вне зависимости от наличия наблюдателя.