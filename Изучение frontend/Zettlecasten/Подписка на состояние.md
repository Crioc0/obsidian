2025 07 0717 06
Tags: #vue 
###### Links: 
1) 
# Заметка
Вы можете следить за состоянием и его изменениями с помощью метода хранилища `$subscribe()`, аналогичного [методу subscribe](https://vuex.vuejs.org/api/#subscribe) во Vuex. Преимущество subscribe перед обычным watch заключается в том, что подписки срабатывают только один раз после изменений. 
```js
cartStore.$subscribe((mutation, state) => {
  // import { MutationType } from 'pinia'
  mutation.type // 'direct' | 'patch object' | 'patch function'
  // тоже самое что и cartStore.$id
  mutation.storeId // 'cart'
  // доступно только при mutation.type === 'patch object'
  mutation.payload // patch object passed to cartStore.$patch()

  // сохранять все состояние в local storage при каждом его изменении
  localStorage.setItem('cart', JSON.stringify(state))
})
```
По умолчанию _подписки на состояние_ привязаны к компоненту, в котором они добавлены (если хранилище находится в `setup()` компонента). Это означает, что они будут автоматически удалены, когда компонент будет размонтирован. Если вы также хотите сохранить их после того, как компонент будет размонтирован, передайте `{ detached: true }` в качестве второго аргумента, чтобы _отсоединить подписку на состояние_ от текущего компонента:
```js
<script setup>
const someStore = useSomeStore()

// эта подписка будет сохраняться даже после размонтирования компонента
someStore.$subscribe(callback, { detached: true })
</script>
```
Можно наблюдать за всем состояниям экземпляра Pinia с помощью одного watch
```jwatch(
  pinia.state,
  (state) => {
    // сохранять все состояние в local storage при каждом его изменении
    localStorage.setItem('piniaState', JSON.stringify(state))
  },
  { deep: true }
)
```