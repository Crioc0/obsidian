---
created: 2025-10-07 08:36
tags:
  - typeORM
---
# 202510070836 Генерация значений в записях средствами СУБД TypeORM

*Ссылка на StructureNote:* [[TypeORM]]
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/learn/backend-nodejs/courses/a4214ab0-2146-4152-b90e-651bf4c7ca5e/sprints/564244/topics/104f2765-a9c9-4617-8a5e-f21b675cf9b3/lessons/5674c491-8940-41ba-bf49-d6da1cbe2337/)

Не все значения для новых записей можно сгенерировать из кода

- Если мы создаём автоинкрементное значение, то о его новом значении должна знать база, а не код.
- Если мы добавляем дату создания или изменения записи, то не стоит полагаться на значение даты в клиенте. Оно может заметно «устареть» в случае долгой операции, а ещё на клиенте может быть дата в часовом поясе, который не совпадает с часовым поясом СУБД. Поэтому стоит всегда полагаться именно на дату на сервере.
- Если нужен UUID, а не автоинкрементное значение, лучше не использовать генерацию UUID в Node.js, а отдать на откуп СУБД

Декоратор `@CreateDateColumn` даст возможность не передавать дату, но и получить сгенерированную дату после создания записи в СУБД. А `@PrimaryGeneratedColumn('uuid', {})` создаст нам UUID.

Предположим, что мы хотим использовать функции `GETUTCDATE` для получения даты, а `NEWID` для генерации идентификатора. В этом случае мы можем передать значение, генерируемое SQL запросом, в виде стрелочной функции, которая возвращает нужную нам часть SQL-запроса:

```ts
const arrayOfEntities: Array<EntityClass> = someData.map((row) => {
      return {
        ...row,
        id: (() => 'NEWID()') as unknown as string,
        createdAt: (() => 'GETUTCDATE()') as unknown as Date,
      };
    });
await this.repo.insert(arrayOfEntities);
```

Обратите внимание, что здесь придётся приводить типы через `as unknown as smth`. Поскольку мы знаем, что мы получим в результате вызова SQL-функции, а вот ORM этого знать не может.

### Связанные идеи:

* 
---

*Что стоит развить? Какие вопросы возникли?*
