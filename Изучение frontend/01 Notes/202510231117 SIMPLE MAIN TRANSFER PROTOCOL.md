---
repeat: spaced every day
created: 2025-10-23 11:17
tags:
  - network
aliases:
  -
---
*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):*
- [[202510231057 Почта|Почта]]

# 202510231117 SIMPLE MAIN TRANSFER PROTOCOL

**SMTP** задает правила общения между сервисом электронной почты и клиентским компьютером. **SMTP** более сложен, чем протоколы запроса-ответа, такие как DNS и NTP.

Во-первых, письма могут содержать сообщения, которые не помещаются в один IP-пакет. Когда электронная почта передается многим IP-пакетам, важно, чтобы полезная их полезная нагрузка была собрана в нужном порядке. По это причине SMTP работает на TCP, а не на UDP.

Почтовые сервисы ожидают входящих подключений через TCP-порт 25. Когда соединение установлено, сервер начинает взаимодействие. Он посылает сообщение, чтобы идентифицировать себя

```
220 mail-server.example.com
```

Все сообщения начинаются с трехзначного номера, называемого кодом возврата. После кода сервер указывает собственное имя. В ответ клиент должен отправить команду **HELO**, чтобы идентифицировать себя

```
HELO client.code.energy
```

На этом этапе сервер решает, хочет ли он продолжить общение, основываясь на том, кем является клиент. Если почтовый сервис решает продолжить, он отправляет код ответа 250, который означает, что действие, запрошенное клиентом, было принято

```
250 mail-server.example.com
```

При этом первом обмене и клиент, и сервер подтвердили, что они собираются передать письмо. Далее клиенту нужно указать обратный адрес электронной почты, которая будет передана. Если сервер не может доставить электронное письмо, он отправит другое письмо на обратный адрес, сообщив о проблеме

```
MAIL FROM: <ada@code.energy>
```

У сервера есть возможность принять или отклонить эти данные, например, если сервер настроен на прием только с определенных адресов. Если адрес принят, сервер принимает код 250

```
250 Ок
```

Затем клиент должен сообщить серверу о целевом почтовом ящике

```
RCPT TO: <charles@example.com>
```

Сервер подтверждает, принимает ли он этот почтовый ящик назначения. Если сервер принимает адрес, он возвращает код 250

```
250 Ок
```

Теперь клиент может отправить команду **DATA**. Эта команда просит сервер начать передачу сообщения электронной почты.

```
DATA
```

Сервер подтверждает и инструктирует клиента сигнализировать об окончании передачи строкой, содержащей только точку. Код 354 информирует клиента о том, что сервер будет рассматривать следующие символы, которые он получит‚ как часть сообщения электронной почты

```
354 End data with <CR><LF>.<CR><LF>
```

Затем клиент передает сообщение. Заголовки From, To и Date являются обязательными. Так же можно указать заголовок **Subject**. Тело сообщения также необязательно

```
From: <ada@code.energy>
Date: Wed, 27 Nov 2002 15:30:34 +0100 
To: <charles@example.com>

That brain of mine is something more than merely mortal; as time will show. 
.
```

После получения завершающих `<CR><LF>.<CR><LF>` сервер проверяет допустимость полученных данных и формально принимает сообщение, если это так. Многие серверы также сообщают клиенту внутренний идентификатор, который они назначают полученному электронному письму

```
250 Ok: queued as 1079212633C
```

# Связанные идеи

- 

---

*Что стоит развить? Какие вопросы возникли?*
