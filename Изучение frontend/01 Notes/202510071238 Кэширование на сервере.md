---
created: 2025-10-07 12:38
tags:
  - unknown-tag
---
# 202510071238 Кэширование на сервере

*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):*  [ЯПрактикум](https://practicum.yandex.ru/trainer/backend-nodejs/lesson/c853ccd2-0bf3-4f5d-9bb9-b319db84e934/task/b04bd35c-bf4e-48f0-9512-98d11fa8c2c8/)

Кэширование на сервере применяется в двух случаях: слишком долгие вычисления или слишком долгие запросы к сторонним сервисам, например к базе данных. В обоих случаях решение простое: сделать долгое действие один раз, сохранить результат и положить его в какое-нибудь быстрое хранилище. А при повторных запросах просто доставать данные оттуда.

Где же хранить кэш, чтобы быстро его доставать? Самый быстрый вариант — оперативная память. Грубо говоря, можно завести объект, в который будут складываться результаты вычислений. Вот пример простейшего кэширования:

```ts
const cache: Record<number, number> = {};

function factorial(n: number): number {
  if (n === 0) {
    return 1;
  }

  return n * factorial(n - 1);
}

function factorialWithCache(n: number): number {
  if (!(n in cache)) {
    cache[n] = factorial(n);
  }

  return cache[n];
}
```

Чтобы такое кэширование можно было использовать для любых значений, можно описать класс `CacheManager` с двумя методами — `set` и `get`:

```ts
class CacheManager {
  private storage: Record<string, unknown> = {};

  public set<T>(key: string, value: T) {
    this.storage[key] = value;
  }

  public get<T>(key: string): T {
    return this.storage[key] as T;
  }
}
```

С помощью такого кэш-менеджера можно кэшировать всё что угодно: результаты вычислений, данные из базы данных и любые другие значения.

```ts
const cache = new CacheManager(); 

async function findUserById(id: string) {
  const cacheKey = 'user';

  if (cache.get(cacheKey) === undefined) {
    const user = await usersDb.findOne({ id });

    cache.set(cacheKey, user);
  }

  return cache.get(cacheKey);
}

// первый раз функция выполнит запрос к базе данных
findUserById('1');

// во второй раз возьмёт данные из кэша
findUserById('1');
```

Но хранить данные в кэше вечно нельзя. Если пользователь поменяет свою аватарку, в кэше данные останутся старыми. Нужно каким-то образом заменить данные в кэше — это называется инвалидацией кэша.

### Связанные идеи:

* [[202510071245 Инвалидация кэша]]
---

*Что стоит развить? Какие вопросы возникли?*
