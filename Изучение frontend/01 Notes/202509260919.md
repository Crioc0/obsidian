---
created: 2025-09-26 09:19
tags:
  - mongoose
  - backend
---
# 202509260919
*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/learn/backend-nodejs/courses/16b47298-e20d-4fde-9619-1ab305039a00/sprints/564238/topics/a4928f0d-5f69-4053-bea3-fa90d3a2a89f/lessons/0964829b-5b6d-4372-b84d-44a076b97b5a/)

При обновлении мы находим запись и меняем её свойства.
- Обновление конкретной записи. Для этого есть метод `findByIdAndUpdate`, который принимает на вход идентификатор в строковом виде. Вторым параметром ему передают объект со свойствами, которые нужно обновить
- Поиск первого совпадения с запросом и обновление его. Для этого есть метод `findOneAndUpdate`, который принимает на вход два объекта: первый с параметрами поиска, второй — с данными, каковой нужно обновить.
- Поиск всех совпадений с запросом и преобразование его. Методом `update`

Есть тонкость в работе методов обновления: по умолчанию параметр, который получает на вход обработчик then, — это документ до обновления:
```ts
User.findByIdAndUpdate(req.params.id, { name: 'Виктор Гусев' })
  // user здесь — это документ до обновления
  .then(user => res.send({ data: user }));
```

Это можно исправить. Поэтому третьим аргументом методы обновления документов принимают объект опций. Нас интересуют три из них:

| Опция         | Что значит                                           | Значение по умолчанию |
| ------------- | ---------------------------------------------------- | --------------------- |
|               |                                                      |                       |
| new           | передать обновлённый объект на вход обработчику then | false                 |
| runValidators | валидировать новые данные перед записью в базу       | false                 |
| upsert        | если документ не найден, создать его                 | false                 |


Благодаря объекту опций мы можем передать в `then` уже обновлённую запись. А также настроить валидацию и создать документ, если он не был найден
### Связанные идеи:
* [[202509260828 Модели mongoose]]
---

*Что стоит развить? Какие вопросы возникли?*