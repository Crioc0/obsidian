---
created: 2025-10-07 11:37
tags:
  - nestjs
---
# 202510071137
*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/trainer/backend-nodejs/lesson/64506ddc-7e9d-440a-acf6-bda3f77dd69f/)



Чем сложнее становится конфигурация вашего приложение и чем больше разных окружений — тем сложнее отслеживать корректность конфигурации для каждого окружения. Например, при пуше в новую ветку автоматически создаётся тестовое окружение со своей базой данных. Как убедиться, что для каждого такого окружения будет указана ссылка для подключения к базе данных? В этом и поможет валидация конфигурации.

Для валидации `@nestjs/config` использует пакет [`joi`](https://www.npmjs.com/package/joi) — библиотеку, которая позволяет быстро составлять схемы валидации. Разработчик указывает, какие в конфигурации есть поля и какие в них должны быть значения, а модуль по этой схеме проверяет корректность конфига.

```ts
import * as Joi from 'joi';

const shcema = Joi.object({
  // port должен быть целым числом со значением по умолчанию 3000
  port: Joi.number().integer().default(3000),
  // databse это объект с полями url и port
  database: Joi.object({
    // url должно быть строкой и соответствовать регулярному выражению
    url: Joi.string().pattern(/postgres:\/\/[a-zA-Z]/),
    // port должен быть целым числом
    port: Joi.number().integer(),
  }),
});
```
Эту схему достаточно передать в свойство `validationSchema`:
```ts
import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import configuration from './configuration';
import * as Joi from 'joi';

const schema = Joi.object({
  port: Joi.number().integer().default(3000),
  database: Joi.object({
    url: Joi.string().pattern(/postgres:\/\/[a-zA-Z]/).required(),
    port: Joi.number().integer().required(),
  }),
});

@Module({
  imports: [
    ConfigModule.forRoot({
      validationSchema: schema,
      load: [configuration],
    }),
  ],
})
export class AppModule {}
```

Теперь, если приложение запустится не на том порту или не с тем URL, при помощи валидации вы поймёте, где искать ошибку. Вы можете познакомиться с другими примерами схем [в официальной документации Joi](https://joi.dev/api/?v=17.6.0).
### Связанные идеи:
* [[202510071058 Конфигурация сервера. ENV. ConfigModule Nest.js]]

---

*Что стоит развить? Какие вопросы возникли?*