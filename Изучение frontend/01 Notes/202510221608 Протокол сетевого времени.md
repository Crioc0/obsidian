---
repeat: spaced every 48 hours
created: 2025-10-22 16:08
tags:
  - network
aliases:
  -
due_at: 2025-10-26T08:28:53.692+03:00
---
*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):*
- [[202510221602 Время|Время]]

# 202510221608 Протокол сетевого времени

Группа компьютеров может регистрировать сотни записей в секунду. Чтобы сохранить эти записи в хронологическом порядке, необходимо синхронизировать часы с точностью до миллисекунды.

Такую точность трудно получить, так как если отправлять сообщение через интернет с запросом о времени, временная метка в IP-пакете придет гарантированно позже запроса. Имея некоторые данные, можно определить, сколько времени потребовалось пакету для прохождения через интернет. затем эту продолжительность можно добавить к указанной метке времени и после этого ее можно использовать для настройки часов. Протокол сетевого времени(Network Tyme Protocol, **NTP**), является широко используемым стандартом для синхронизации часов по этому принципу

Метки времени NTP выражаются в секундах с полуночи 1 января 1900 года. Например, метка времени полуночи 1 января 2000 года будет выглядеть как 3 155 673 600. Число может иметь дробную часть, поэтому может фиксировать время с очень высокой точностью. Серверы NTP ожидают входящие сообщения на UDP-порте 123. Обмен сообщениями NTP работает так

![[Обмен времени.png]]

Предположим, что время D равно 319,42 Зная моменты времени A, B, C и D, клиент может рассчитать время прохождения IPпакетов через интернет: время в пути = время в пути клиента – время обработки сервера = = D – A – (C – B) = = 319,42 – 315,27 – (319,32 – 316,61) = = 4,15 – 2,71 = = 1,44.

Потребовалось 1,44 секунды, чтобы сообщения прошли от клиента к серверу и обратно. Мы можем приблизительно подсчитать, что для передачи пакета от сервера к клиенту потребовалось вдвое меньше времени: 0,72 секунды. Клиент должен был получить ответ через 0,72 секунды после времени C, в 319,32 + 0,72 = 320,04. Однако клиент получил сообщение, когда его часы показывали только 319.42. Это означает, что часы клиента опаздывают, по сравнению с сервером, примерно на 320,04 – 319,42 = 0,62 секунды. NTP консервативен: он предписывает клиентам корректировать свои часы только на половину предполагаемого смещения. Таким образом, наш клиент переводит свои часы на 0,31 секунды вперед. Каждые десять минут клиент отправляет новый запрос и соответствующим образом подстраивает свои часы. Если время прохождения пакетов между клиентом и сервером одинаково в обоих направлениях, часы клиента в итоге синхронизируются с часами сервера. На типичных интернет-каналах NTP синхронизирует часы с ошибкой в десятки миллисекунд.

# Связанные идеи

- 

---

*Что стоит развить? Какие вопросы возникли?*
