---
created: 2025-10-07 12:45
tags:
  - network
repeat: spaced every day
due_at: 2025-10-24T06:00:00.000+03:00
---
# 202510071245 Инвалидация кэша

*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/trainer/backend-nodejs/lesson/c853ccd2-0bf3-4f5d-9bb9-b319db84e934/task/b04bd35c-bf4e-48f0-9512-98d11fa8c2c8/)

Если закэшированные данные изменились, кэш нужно проинвалидировать (дословно — «признать недействительным»), или, по-простому, очистить. Для этого в `CacheManager` понадобится добавить метод `del`:

```ts
public del(key: string) {
  delete this.storage[key];
}
```

Инвалидировать кэш можно вручную или автоматически, например по таймеру. Вручную очищать кэш нужно при изменении данных. Например, если данные пользователя обновились:

```ts
function await updateUserById(id: string, data: object) {
  const cacheKey = 'user';

  // если мы обновили данные пользователя в БД,
  await usersDb.updateOne({ id }, object);

  // проинвалидируем кэш
  cache.del(cacheKey);
}
```

По таймеру кэш обычно очищают на всякий случай или если нет возможности проверить, обновились ли данные. Например, если в базу данных записи делает не только наше приложение, но и другой сервис. В конструктор `CacheManager` можно передавать параметр `ttl` (time to live) — время жизни кэша, после которого его нужно инвалидировать:

```ts
class CacheManager {
  private timeouts: Record<string, number> = {}

  constructor(private ttl: number) {}

  set<T>(key: string, value: T) {
    this.storage[key] = value;

    if (key in this.timeouts) {
      clearTimeout(this.timeouts[key]);
    }

    // если параметр ttl не указан, кэш будет храниться неограниченно
    if (!this.ttl) {
      return;
    }

    const timeout = setTimeout(() => {
      this.del(key);
      delete this.timeouts[key];
    }, this.ttl)

    this.timeouts[key] = timeout;
  }
}

// устанавливаем время жизни кэша равным одной минуте
const cache = new CacheManager(60 * 1000);
```

Теперь, если передать в конструктор время в миллисекундах, данные из кэша будут автоматически удаляться.

### Связанные идеи:

* 

---

*Что стоит развить? Какие вопросы возникли?*
