---
created: 2025-10-08 10:03
tags:
  - unknown-tag
repeat: spaced every day
due_at: 2025-10-24T06:00:00.000+03:00
---
# 202510081003 Заголовок If-None-Match

*Ссылка на StructureNote:*
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/learn/backend-nodejs/courses/a4214ab0-2146-4152-b90e-651bf4c7ca5e/sprints/564244/topics/30b04f32-dfb9-4449-8b8a-076fafa5924b/lessons/c31f0466-0632-4f59-8b91-01c4fe1a28f6/)

`If-None-Match` работает схожим образом с `If-Modified-Synce`

Но вместо времени последнего изменения, браузер отправляет специальный токен — `ETag`. Этот токен генерирует сервер и отправляет с каждым запросом в одноимённом заголовке:

```
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4" 
```

Обычно в качестве токена используют хэш от содержимого ответа. Если ответ поменяется, поменяется и хэш.

Итого для `If-None-Match` валидация кэша происходит так:

1. Браузер запрашивает ресурс в первый раз.
2. Сервер отдает ресурс вместе с такими заголовками.

```
Cache-Control: no-cache, max-age=31536000;
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"; 
```

1. В следующий раз браузер увидит ресурс в кэше, но всё равно отправит запрос с заголовком `If-None-Match`.

```
If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4" 
```

1. Если ресурс не изменился, сервер вернёт пустой ответ со статусом `304 Not Modified` и таким же `ETag`, и браузер отдаст ресурс из кэша.
2. Если же ресурс изменился, сервер вернёт его вместе с обновлённым заголовком `ETag`.

И `Last-Modified` и `ETag` можно использовать одновременно, они не будут конфликтовать друг с другом. Например, браузер отправит такой запрос:

```
If-None-Match: "33a64df551425fcc55e4d42a148795d9f25f89d4";
Last-Modified: Wed, 22 Jun 2022 12:00:00 GMT; 
```

А сервер уже решит, как реагировать. Например, если время последнего изменения обновилось, но сам контент остался таким же, сервер может ответить `304 Not Modified`.

Токены `ETag` бывают двух видов: сильные и слабые (`strong` и `weak` соответственно). Отличаются они тем, что сильные токены меняются при любых изменениях ответа. А слабые меняются, только если содержимое ответа изменилось семантически. Например, мы можем вернуть файл как в обычном формате, так и сжатым в формате `gzip`. Сильный `ETag` изменится, а вот слабый останется таким же, потому что поменялся формат, но не содержимое файла.

Обратите внимание, что это работает, только если для `Cache-Control` указана директива `no-cache`. Для `private` или `public` браузер не будет валидировать кэш, пока время его жизни не истечёт.

# Связанные идеи:

* [[202510080958 Валидация кэша]]

---

*Что стоит развить? Какие вопросы возникли?*
