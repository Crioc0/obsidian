---
created: 2025-10-07 10:22
tags:
  - typeORM
---
# 202510071023
*Ссылка на StructureNote:* [[TypeORM]]
*Ссылка на исходник или контекст (если есть):* [ЯПрактикум](https://practicum.yandex.ru/learn/backend-nodejs/courses/a4214ab0-2146-4152-b90e-651bf4c7ca5e/sprints/564244/topics/104f2765-a9c9-4617-8a5e-f21b675cf9b3/lessons/1a33d1dc-5929-45e0-98a4-01974cd651dc/)

У нас уже есть настройки базы данных в `app.module.ts`, однако CLI для TypeORM не умеет их оттуда брать. Так что нужно создать отдельный файл настроек в понятном для CLI формате. Например, так:
```ts
// ormconfig.ts
import { DataSource } from 'typeorm';

export const AppDataSource = new DataSource({
  type: 'postgres',
  host: 'localhost',
  port: 5432,
  username: 'student',
  password: 'student',
  database: 'nest_project',
  entities: ['src/**/entities/*.entity{.ts,.js}'],
  migrations: ['src/database/migrations/*.ts'],
  synchronize: false,
});
```
По умолчанию TypeORM работает только с JS-файлами миграций. Чтобы это исправить, нужно добавить несколько команд в `package.json` для удобства
```ts
"scripts": {
    "typeorm": "ts-node --files -r tsconfig-paths/register ./node_modules/typeorm/cli.js --dataSource ormconfig.ts",
    "migrate:generate": "npm run typeorm migration:generate -n",
    "migrate:create": "npm run typeorm migration:create -n",
    "migrate:up": "npm run typeorm migration:run",
    "migrate:down": "npm run typeorm migration:revert"
}
```
Первая команда будет оборачивать вызовы TypeORM, добавляя туда транспиляцию для использования TS-файлов, а также подставлять файл настроек, о котором мы говорили выше. Остальные команды оборачивают соответствующие команды TypeORM и вызывают нашу переопределённую команду `typeorm`.

Что мы здесь видим интересного:

- `migrate:generate` — создаёт новую миграцию на основании разницы текущего состояния нашей БД и описанных моделей.
- `migrate:create` — создаёт пустую миграцию, код которой можно написать руками.
- `migrate:up` — выполняет код миграции над нашей базой.
- `migrate:down` — откатывает последнюю миграцию.
### Связанные идеи:
* [[202510071022 Миграции]]
---

*Что стоит развить? Какие вопросы возникли?*