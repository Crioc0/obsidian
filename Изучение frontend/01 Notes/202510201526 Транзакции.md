---
created: 2025-10-20 15:26
tags:
  - database
---
# 202510201526 Транзакции

*Ссылка на StructureNote:* [[Database]]
*Ссылка на исходник или контекст (если есть):* 

Отличный текст! Он очень наглядно объясняет необходимость транзакций. Вот отформатированная и слегка улучшенная версия, разбитая на логические разделы для лучшего восприятия.

---

### **Проблема: Необходимость атомарности в операциях**

Представим, что скрытный швейцарский банк не ведет учета денежных переводов: его база данных просто хранит баланс счетов.

**Сценарий:** Кто-то хочет перечислить деньги со своего счета на счет друга в том же банке. Для этого в базе данных должны быть выполнены две операции:
1.  Сумму нужно **вычесть** из баланса одного счета.
2.  Эту же сумму нужно **прибавить** к балансу другого счета.

### **Риски при параллельном выполнении**

Сервер СУБД обычно позволяет многочисленным клиентам читать и записывать данные одновременно. Последовательное выполнение операций сделало бы систему слишком медленной. Однако это параллельное выполнение создает риски:

1.  **Несогласованное состояние данных:** Если кто-то запросит общий баланс всех счетов *после* регистрации вычитания, но *до* соответствующего добавления, часть денег будто бы исчезнет из системы.
2.  **Аппаратные сбои:** Что, если система обесточится *между* этими двумя операциями? После перезапуска будет крайне сложно выяснить причину расхождения в данных — деньги просто пропадут.

### **Решение: Транзакции**

Нам нужен механизм, гарантирующий, что СУБД выполнит **либо все** изменения в рамках многосоставной операции, **либо ни одного**. Для этого системы баз данных поддерживают **транзакции**.

**Транзакция** — это группа последовательных операций с данными, которые должны быть выполнены **атомарно**.

> **Атомарность** означает, что операция выполняется как единое целое: она не может быть выполнена наполовину.

Транзакции упрощают жизнь программиста: ответственность за обеспечение непротиворечивости данных берет на себя СУБД. От программиста требуется лишь обернуть зависимые операции в соответствующие команды.

**Пример на SQL:**

```sql
START TRANSACTION;
UPDATE vault SET balance = balance - 50 WHERE id = 1;  -- Списать с 1-го счета
UPDATE vault SET balance = balance + 50 WHERE id = 2;  -- Зачислить на 2-й счет
COMMIT;
```

### **Ключевой вывод**

Выполнение многосоставных обновлений **без транзакций** рано или поздно приведет к беспорядочным, непредсказуемым и трудно обнаруживаемым противоречиям в ваших данных.

# Связанные идеи

- [[202510071029 Согласованность данных. Транзакции]]
---

*Что стоит развить? Какие вопросы возникли?*
