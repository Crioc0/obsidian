---
created: 2025-10-08 10:40
tags:
  - nestjs
---
# 202510081040
*Ссылка на StructureNote:* [[Nest.js]]
*Ссылка на исходник или контекст (если есть):* 

Так как Nest.js использует Express в качестве HTTP-сервера по умолчанию в ответах на запросы, Express будет автоматически выставлять слабый `ETag` ко всем ответам. Мы можем изменить его на строгий в файле `main.ts`:

```ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { NestExpressApplication } from '@nestjs/platform-express';

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule);

  app.set('etag', 'strong');

  await app.listen(3000);
}

bootstrap();
```
Или даже самостоятельно указать функцию для генерации `ETag`:
```ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { NestExpressApplication } from '@nestjs/platform-express';
// импортируем функцию etag из одноименного модуля
import * as etag from 'etag';

async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule);

  // регистрируем функцию в Express
  app.set('etag', etag);

  await app.listen(3000);
}

bootstrap();
```
Если браузер отправит запрос с заголовком `If-None-Match`, Nest.js автоматически ответит `304 Not Modified`, если `ETag` совпадает с текущим. Нам остаётся только указать браузеру, для каких ресурсов этот запрос нужно отправлять. Для этого достаточно установить заголовок `Cache-Control` с помощью декоратора `@Header`:
```ts
import { Controller, Get, Header } from '@nestjs/core';

@Controller('cities')
export class CitiesController {
  // указываем браузеру валидировать кэш при каждом запросе, время жизни — 1 день
  @Header('Cache-Control', 'no-cache, max-age=86400')
  @Get('capitals')
  getCapitals() {
    return ['Moscow', 'London', 'Warsaw', 'Berlin'];
  }
}
```
Теперь браузер будет делать запрос к серверу каждый раз, но сервер будет отвечать `304 Not Modified`, пока список городов не изменится.

# Связанные идеи:
* 
---

*Что стоит развить? Какие вопросы возникли?*